<!DOCTYPE html>
<html>

<head>
  <title>vue-form example</title>
  <meta charset="utf-8" />
  <style>
    label {
      display: block;
      margin-bottom: 1.5em;
    }

    label>span {
      display: inline-block;
      width: 8em;
      vertical-align: top;
    }
  </style>
</head>

<body>
  <div id="app">

    <vue-form :state="formstate" v-model="formstate" @submit.prevent="onSubmit">

      <button type="button" @click="isReq = !isReq">Toggle</button>
      <button type="button" @click="changeStuff">Change stuff</button>

      <!--
            <label>
                <span>Name *</span>
                <validate :required="isReq" min-length="10" max-length="40" pattern="/sdfsdffd/">
                    <input v-model="model.name" name="name" />
                </validate>
            </label>

            <label>
                <span>Email *</span>
                <validate required>
                    <input v-model="model.email" name="email" type="email" />
                </validate>
            </label>

            <label>
                <span>component</span>
                <validate required>
                    <test v-model="model.name" name="foobar"></test>
                </validate>
            </label>

            ====================

                <form-error :field="formstate.name" error="required">Name is a required field 2</form-error>
                <form-error :field="formstate.name" error="minlength">Min length is not satisfied</form-error>

                <form-errors :field="formstate.name">
                    <div slot="pattern">Pattern don't match</div>
                    <div slot="required">Field is required</div>
                    <div slot="minlength">minlength not satisfied</div>
                </form-errors>
            <validate tag="label">
        <span>testcomp</span>
        <test v-model="model.testcomp" :minlength="minLength" :required="isReq" name="testcomp"></test>
      </validate>
            <validate tag="label" :custom="customA">
        <span>foo</span>
        <input name="name" type="text" v-model="model.name" :required="isReq" />
      </validate>
  -->



      <validate tag="label" :custom="{customA: customA, customB: customB}">
        <span>foo</span>
        <input name="foo" people-picker-required type="text" v-model="model.foo" :required="isReq" pattern="foo" />
      </validate>

   <!--
      <label>
          <span>Name</span>
          <validate>
            <input :minlength="3" v-model="model.name" name="name" :required="isReq" pattern="foo" />
          </validate>
      </label>

      <validate tag="label" v-if="isReq">
        <span>foo2</span>
        <input name="foo2" type="text" v-model="model.foo2" :required="isReq" />
      </validate>

            <form-errors field="foo">
                <div slot="required">Field is required</div>
            </form-errors>
            <form-error field="foo" error="required">Name is a required field 2</form-error>
            -->
      <!--
            <label>
                <span>foo</span>
                <input name="foo" type="text" v-model="model.foo" required="false" />
            </label>

            <label>
                <span>Email</span>
                <input v-form v-model="model.email" name="email" type="email" :required="isReq" />
            </label>

            <label>
                <span>component</span>
                <test v-validate v-model="model.testcomp" :required="isReq" name="foobar"></test>
            </label>


            <label>
                <span>Request call back</span>
                <validate :model="model.contactRequired"><input v-model="model.contactRequired" type="checkbox" name="contactRequired" /></validate>
            </label>


            <label>
                <span>Contact details <span v-if="model.contactRequired">*</span></span>
                <textarea v-model="model.contact" :required="model.contactRequired" name="comments"></textarea>
            </label>

            <div v-if="model.contactRequired">
                <p>Extra contact fields</p>

                <label>
                    <span>3 digit code *</span>
                    <input v-model="model.code" name="code" type="text" pattern="[A-Za-z]{3}" required />
                </label>

            </div>
                    -->
      <button type="submit">Submit</button>
    </vue-form>

    <pre>{{formstate}}</pre>

  </div>

  <script src="../node_modules/vue/dist/vue.js"></script>
  <script src="../dist/vue-form.js"></script>
  <script>

//Vue.use(vueForm);

    vueForm.addValidator('people-picker-required', function (model, attrValue, vnode){
      if (model !== 'scot') {
        return false;
      }
      return true;
    });

    var vm = new Vue({
      el: '#app',
      mixins: [vueForm.mixin],
      components: {
        test: {
          props: {
            value: String,
            minlength: Number,
            required: Boolean
          },
          data() {
            return {
              internalValue: ''
            }
          },
          template: '<span>TEST<input @input="update" v-model="internalValue"  /></span>',
          created() {
            this.$watch('value', () => {
              this.internalValue = this.value;
            }, {
              immediate: true
            });
          },
          methods: {
            update() {
              this.$emit('input', this.internalValue);
            }
          }
        }
      },
      data: {
        isReq: true,
        minLength: 5,
        formstate: {},
        model: {
          foo: 'n',
          foo2: '',
          email: '',
          name: 'name',
          contact: '',
          testcomp: '',
          contactRequired: false
        }
      },
      methods: {
        customA () {
          return true;
        },
        customB (value) {
          return new Promise(function (resolve, reject) {
            setTimeout(function () {
              resolve(value === 'async');
            }, 1000);
          });
        },
        customC (value, done) {
          setTimeout(function () {
            done(value === 'async');
          }, 1000);
        },
        changeStuff: function() {
          this.isReq = !this.isReq;
          this.minLength = 10;
          this.model.name = this.model.name + 'foo';
        },
        onSubmit: function() {
          console.log(this.formstate.$valid);
        }
      }
    });
  </script>

</body>

</html>
